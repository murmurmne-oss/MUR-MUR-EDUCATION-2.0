# Как получить строку подключения к базе данных OVH

Пошаговая инструкция с описанием интерфейса OVH.

## Шаг 1: Войдите в панель OVH

1. Откройте https://www.ovh.com/manager/
2. Войдите в свой аккаунт

## Шаг 2: Найдите раздел с базами данных

В верхнем меню найдите:
- **"Databases"** (Базы данных) или
- **"Web Cloud"** → **"Databases"**

Или в левом меню:
- **"Web Cloud"** → **"Databases"** → **"PostgreSQL"**

## Шаг 3: Откройте вашу базу данных

1. В списке баз данных найдите созданную базу `murmur_staging` (или production БД, чтобы понять формат)
2. Нажмите на название базы данных

## Шаг 4: Найдите информацию о подключении

После открытия базы данных вы увидите несколько вкладок/разделов:

### Вариант A: Вкладка "General information" (Общая информация)

1. Откройте вкладку **"General information"** или **"Общая информация"**
2. Найдите раздел **"Connection information"** или **"Информация о подключении"**
3. Там будет строка подключения в формате:
   ```
   postgresql://username:password@host:port/database
   ```

### Вариант B: Вкладка "Users" (Пользователи)

1. Откройте вкладку **"Users"** или **"Пользователи"**
2. Найдите пользователя базы данных
3. Нажмите на пользователя или кнопку **"Show password"** / **"Показать пароль"**
4. Там будет информация:
   - **Host** (хост)
   - **Port** (порт, обычно 5432)
   - **Database** (имя базы данных)
   - **Username** (имя пользователя)
   - **Password** (пароль)

### Вариант C: Вкладка "Connection information" (Информация о подключении)

Некоторые версии панели OVH имеют отдельную вкладку:
1. Откройте вкладку **"Connection information"** или **"Информация о подключении"**
2. Там будет готовая строка подключения

## Шаг 5: Соберите строку подключения вручную

Если вы видите отдельные поля (Host, Port, Database, Username, Password), соберите строку вручную:

**Формат:**
```
postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE
```

**Пример:**
Если у вас:
- Host: `postgresql-abc123-def456.ovh.net`
- Port: `5432`
- Database: `murmur_staging`
- Username: `murmur_user`
- Password: `MyPassword123`

То строка будет:
```
postgresql://murmur_user:MyPassword123@postgresql-abc123-def456.ovh.net:5432/murmur_staging
```

## Шаг 6: Альтернативный способ - через OVH API

Если в панели сложно найти, можно использовать OVH API или CLI, но это более сложный способ.

## Визуальное описание интерфейса

Типичный интерфейс OVH выглядит так:

```
┌─────────────────────────────────────────┐
│ OVH Manager                             │
├─────────────────────────────────────────┤
│ [Web Cloud] [Databases] [PostgreSQL]    │
├─────────────────────────────────────────┤
│                                         │
│  База данных: murmur_staging           │
│  ┌─────────────────────────────────┐   │
│  │ General information             │   │
│  │                                 │   │
│  │ Connection information:         │   │
│  │ postgresql://user:pass@...     │   │
│  │                                 │   │
│  │ [Copy] [Show password]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Users] [Databases] [Backups]          │
└─────────────────────────────────────────┘
```

## Если не можете найти строку подключения

### Способ 1: Соберите вручную из отдельных полей

1. Найдите раздел с информацией о базе данных
2. Запишите:
   - **Host** (хост сервера)
   - **Port** (порт, обычно 5432)
   - **Database name** (имя базы данных)
   - **Username** (имя пользователя)
   - **Password** (пароль - может быть скрыт, нажмите "Show")

3. Соберите строку по формуле:
   ```
   postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE
   ```

### Способ 2: Используйте формат из production

Если у вас уже есть production база данных:

1. Откройте production базу данных в OVH
2. Найдите строку подключения (она будет для production БД)
3. Скопируйте формат и замените:
   - Имя базы данных на `murmur_staging`
   - Пользователя (если создали отдельного)
   - Пароль (если создали отдельного)

**Пример:**
Production:
```
postgresql://murmur_user:ProdPass123@postgresql-abc123.ovh.net:5432/murmur_production
```

Staging (та же БД, но другое имя):
```
postgresql://murmur_user:ProdPass123@postgresql-abc123.ovh.net:5432/murmur_staging
```

Или если создали отдельного пользователя:
```
postgresql://murmur_staging_user:StagingPass123@postgresql-abc123.ovh.net:5432/murmur_staging
```

## Проверка строки подключения

После того как получили строку, проверьте её:

```bash
# На сервере
psql "postgresql://user:password@host:port/database"

# Или через Docker
docker run --rm -it postgres:15 psql "postgresql://user:password@host:port/database"
```

Если подключение успешно - строка правильная!

## Примеры строк подключения OVH

Типичные форматы от OVH:

```
# Формат 1 (с доменом)
postgresql://username:password@postgresql-abc123-def456.ovh.net:5432/database_name

# Формат 2 (с IP)
postgresql://username:password@123.45.67.89:5432/database_name

# Формат 3 (с портом в URL)
postgresql://username:password@postgresql-abc123.ovh.net:5432/database_name
```

## Важные моменты

1. ✅ **Пароль может содержать специальные символы** - их нужно URL-кодировать:
   - `@` → `%40`
   - `#` → `%23`
   - `$` → `%24`
   - `%` → `%25`
   - `&` → `%26`
   - `+` → `%2B`
   - `=` → `%3D`

2. ✅ **Если пароль содержит спецсимволы**, используйте URL-кодирование или экранируйте в кавычках:
   ```bash
   # В .env файле можно использовать как есть
   DATABASE_URL_STAGING=postgresql://user:pass@host:5432/db
   
   # В командной строке используйте кавычки
   psql "postgresql://user:pass@host:5432/db"
   ```

3. ✅ **Проверьте доступность** - убедитесь, что БД доступна с вашего сервера (проверьте firewall/whitelist в OVH)

## Если всё ещё не получается

1. **Сделайте скриншот** интерфейса OVH (скройте пароли!)
2. **Опишите**, что вы видите в панели
3. **Попробуйте найти** раздел "Connection", "Подключение", "Informations de connexion"

Или используйте альтернативный способ - соберите строку вручную из отдельных полей, которые точно видите в интерфейсе.

